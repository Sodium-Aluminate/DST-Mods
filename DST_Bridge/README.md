# DST_Bridge

大概算半个 mod？
## 使用方法

### 游戏服务端
* 将 mod 配置好塞进服务器
  * 根据设置，你可能要自己解决 host 问题
  * 根据设置，你可能得给前端反代签证书，然后把签了的证书塞进系统里。
### 消息转发服务端
消息转发服务端需要实现俩接口。

发消息接口：
* 请求地址： `/sendMessage`
* 请求方法： `POST`
* POST 内容：游戏内玩家说的话（以及玩家名字）。
* 返回值：`200`
* 返回内容：无

收到消息
* 请求地址： `/getMessage`
* 请求方法： `GET`
* 请求参数：`serverPasswd=<服务器密码>`
* 返回值：`200`
* 返回内容：JSON
* JSON 格式：以下任一
```json
{
  "asStr": "群熊大，时不时被拉去砍树：我先吃个饭"
}
```
```json
{
  "message": {
    "from": {
      "first_name": "小杜",
      "last_name": "先生"
    },
    "chat": {
      "title": "杜先生的群"
    },
    "text": "****可能会倒闭，单永远不会变质"
  }
}
```

## 你这破轮子只能算半个啊
没错，因此这里有两个简单的 java http server 示例，你可以自行编译它，或者用你喜欢的语言再写一个。
### 你这破烂示例没说依赖啊
自行怼 Maven 依赖去吧：
```
com.google.code.gson:gson:2.8.9
com.squareup.okhttp3:okhttp:4.9.0
```
（然后除了 openJDK 17 就没了）
### 你这破烂示例没说咋跑啊
用环境变量传参数，然后运行 `Main`。
## 多服务器一个群咋办？
示例里没救，俩服务器会互相抢消息。但实际上你可以通过服务器密码，请求来源 ip 来区分不同的服务器，从而给每个服务器都互通消息。

**咕咕咕！**

## 为什么配置全在消息服务器部分
* 写死在 mod 代码其他人可以下载创意工坊之后胡乱 spam。
* 使用 modinfo 设置的话过于麻烦（我不可能手动输入超长 base64 token）
* 由服务端解决能接口化这个问题，从而使其移植到其他聊天软件（甚至是人工智障上）更加轻松。~~试想一下你的好基友在游戏里发一句话把你的空调关了，是不是很生草？~~